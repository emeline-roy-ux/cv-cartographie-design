<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cartographie de parcours — Design & Recherche</title>

<style>
body { font-family: system-ui, sans-serif; margin: 40px; background:#f5f5f5; color:#222; }
h1 { font-size: 26px; margin: 0 0 12px 0; }
p { max-width: 900px; line-height: 1.6; }
.grid { display:grid; grid-template-columns:1.6fr 1fr; gap:18px; }
.card { background:#fff; padding:18px; border-radius:10px; box-shadow:0 0 0 1px #ddd; }
#viz { width:100%; height:560px; background:#fff; border-radius:10px; box-shadow:0 0 0 1px #ddd; }
.meta { font-size:13px; color:#666; }
.tag { display:inline-block; padding:2px 8px; border:1px solid #ddd; border-radius:999px; margin:4px 6px 0 0; font-size:12px; }
button { border:1px solid #ddd; background:#fff; padding:8px 10px; border-radius:10px; cursor:pointer; }

@media (max-width:900px){
  body { margin:18px; }
  .grid { grid-template-columns:1fr; }
  #viz { height:520px; }
}
</style>
</head>

<body>

<div class="card" style="margin-bottom:18px;">
<h1>Dispositif cartographique — Parcours scientifique en design</h1>
<p>Cartographie relationnelle expérimentale (prototype contrôlé). Le dossier académique complet demeure la référence.</p>

<p class="meta">
<a href="methodologie.html">Méthodologie</a> ·
<a href="https://www.linkedin.com/in/emeline-roy-141a7728/" target="_blank">LinkedIn</a> ·
Dossier complet : sur demande
</p>
</div>

<div class="grid">
<div id="viz"></div>

<div class="card">
<strong>Fiche</strong>
<button id="resetBtn">Réinitialiser</button>
<p class="meta" id="hint">Survol = résumé · clic = déployer</p>
<div id="panel"></div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script>
(async function(){

const data = await fetch("data.json").then(r=>r.json());

const width = document.getElementById("viz").clientWidth;
const height = document.getElementById("viz").clientHeight;

const svg = d3.select("#viz").append("svg")
.attr("width", width)
.attr("height", height);

const g = svg.append("g");

svg.call(d3.zoom().scaleExtent([0.6,2.5]).on("zoom", e => g.attr("transform", e.transform)));


// ---------- voisins (déploiement progressif)
const neighbors = {};
data.links.forEach(l=>{
  neighbors[l.source] ??= new Set();
  neighbors[l.target] ??= new Set();
  neighbors[l.source].add(l.target);
  neighbors[l.target].add(l.source);
});

const macroTypes = new Set(["profil","axe","institution","reseau","position"]);
let visible = new Set(data.nodes.filter(n=>macroTypes.has(n.type)).map(n=>n.id));


// ---------- liens
const link = g.selectAll("line")
.data(data.links)
.join("line")
.attr("stroke","#ccc");


// ---------- noeuds
const node = g.selectAll("circle")
.data(data.nodes)
.join("circle")
.attr("r", d=> d.type==="axe"?16:10)
.attr("fill","#fff")
.attr("stroke","#666")
.style("cursor","pointer");


// ---------- labels
const label = g.selectAll("text")
.data(data.nodes)
.join("text")
.text(d=>d.label)
.attr("font-size",12)
.attr("dx",14)
.attr("dy",4);


// ---------- forces par zones
const zoneX = { profil:.25, publications:.75, recherche:.25, enseignement:.75 };
const zoneY = { profil:.25, publications:.25, recherche:.75, enseignement:.75 };

const sim = d3.forceSimulation(data.nodes)
.force("link", d3.forceLink(data.links).id(d=>d.id).distance(90))
.force("charge", d3.forceManyBody().strength(-240))
.force("x", d3.forceX(d => width*(zoneX[d.zone] ?? .5)).strength(.3))
.force("y", d3.forceY(d => height*(zoneY[d.zone] ?? .5)).strength(.3))
.force("collide", d3.forceCollide(18));

sim.on("tick", ()=>{
  link.attr("x1",d=>d.source.x)
      .attr("y1",d=>d.source.y)
      .attr("x2",d=>d.target.x)
      .attr("y2",d=>d.target.y);

  node.attr("cx",d=>d.x).attr("cy",d=>d.y);
  label.attr("x",d=>d.x).attr("y",d=>d.y);
});


// ---------- visibilité
function updateVisibility(){
node.attr("display", d=> visible.has(d.id)?null:"none");
label.attr("display", d=> visible.has(d.id)?null:"none");
link.attr("display", d=>{
 const sid=d.source.id||d.source;
 const tid=d.target.id||d.target;
 return (visible.has(sid)&&visible.has(tid))?null:"none";
});
}


// ---------- panneau
const panel = document.getElementById("panel");
const hint = document.getElementById("hint");

function renderPanel(d){
hint.textContent="";
panel.innerHTML = `
<p><strong>${d.label}</strong></p>
<p class="meta">${d.type}</p>
${(d.keywords||[]).map(k=>`<span class="tag">${k}</span>`).join("")}
${d.evidence?`<p><a href="${d.evidence}" target="_blank">preuve</a></p>`:""}
`;
}

function reset(){
visible = new Set(data.nodes.filter(n=>macroTypes.has(n.type)).map(n=>n.id));
updateVisibility();
panel.innerHTML="";
hint.textContent="Survol = résumé · clic = déployer";
}

node.on("mouseover",(e,d)=>renderPanel(d))
.on("click",(e,d)=>{
 visible.add(d.id);
 (neighbors[d.id]||[]).forEach(id=>visible.add(id));
 updateVisibility();
 if(d.evidence) window.open(d.evidence,"_blank");
});

document.getElementById("resetBtn").onclick = reset;

node.call(d3.drag()
.on("start",(e,d)=>{ if(!e.active) sim.alphaTarget(.3).restart(); d.fx=d.x; d.fy=d.y; })
.on("drag",(e,d)=>{ d.fx=e.x; d.fy=e.y; })
.on("end",(e,d)=>{ if(!e.active) sim.alphaTarget(0); d.fx=null; d.fy=null; })
);

reset();

})();
</script>
</body>
</html>
